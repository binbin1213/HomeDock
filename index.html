<!DOCTYPE html>
<html>
  
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="renderer" content="webkit" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <link rel="shortcut icon" href="favicon.ico" />

    <!-- ========================================
       âœ… å…³é”® CSS å†…è” - é¦–å±æ¸²æŸ“å¿…éœ€ (~8KB)
       ======================================== -->
    <style>
/* åŸºç¡€é‡ç½® */
*{margin:0;padding:0;box-sizing:border-box}
img{border:0;vertical-align:middle}
ul{margin:0;padding:0;border:none;list-style:none;font-size:12px}
a{color:#fff;text-decoration:none}

/* Body å’ŒèƒŒæ™¯ */
body{
  height:100%;
  font-size:100%;
  background:linear-gradient(135deg,#00C4FF,#9D1BB2) no-repeat fixed;
  overflow-x:hidden;
  overflow-y:auto;
  font-family:'Helvetica Neue','Microsoft Yahei',SimHei,sans-serif;
  position:relative
}

/* èƒŒæ™¯è’™å±‚ */
body::before{
  content:'';
  position:fixed;
  top:0;left:0;right:0;bottom:0;
  background:inherit;
  filter:blur(4px);
  z-index:-1
}
body::after{
  content:'';
  position:fixed;
  top:0;left:0;right:0;bottom:0;
  background:rgba(0,0,0,.15);
  z-index:-1
}

/* ä¸»å®¹å™¨ */
#wrap{width:100%;height:100%;margin:0 auto;overflow:visible;position:relative;z-index:1}
#top{margin-top:15%;width:100%;height:162px}
#main{margin-top:6%}
</style>

    <!-- ä¸»æ ·å¼è¡¨ï¼ˆå…³é”®ï¼‰åŒæ­¥åŠ è½½ -->
    <link rel="stylesheet" type="text/css" href="css/style.css" />

    <!-- å“åº”å¼ CSSï¼ˆåª’ä½“æŸ¥è¯¢æ¡ä»¶åŠ è½½ï¼‰ -->
    <link rel="stylesheet" type="text/css" href="css/responsive.css" media="(max-width: 1024px)" />

    <!-- ========================================
       âœ… éå…³é”® CSS å¼‚æ­¥åŠ è½½
       ======================================== -->

    <!-- æ‹–æ‹½åŠŸèƒ½ CSS - ä»…åœ¨éœ€è¦æ—¶åŠ è½½ -->
    <link rel="preload" href="css/drag-drop.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="css/drag-drop.css"></noscript>

    <!-- å›¾ç‰‡ä¼˜åŒ–å™¨ CSS - ä»…åœ¨éœ€è¦æ—¶åŠ è½½ -->
    <link rel="preload" href="css/image-optimizer.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="css/image-optimizer.css"></noscript>


    <!-- ========================================
       âœ… èµ„æºé¢„åŠ è½½æç¤º (Resource Hints)
       ======================================== -->

    <!-- é¢„åŠ è½½å…³é”® CSS æ–‡ä»¶ -->
    <link rel="preload" href="css/style.css" as="style">
    <link rel="preload" href="css/responsive.css" as="style">

    <!-- é¢„åŠ è½½å…³é”® JavaScript æ–‡ä»¶ -->
    <link rel="preload" href="app.js" as="script">

    <!-- é¢„åŠ è½½æœç´¢å¼•æ“å›¾æ ‡ -->
    <link rel="preload" href="img/baidu.svg" as="image" type="image/svg+xml">

    <!-- DNS é¢„è§£æå’Œé¢„è¿æ¥åˆ°æœç´¢å¼•æ“åŸŸå -->
    <link rel="dns-prefetch" href="//www.bing.com">
    <link rel="dns-prefetch" href="//www.google.com">
    <link rel="dns-prefetch" href="//cn.bing.com">

    <link rel="preconnect" href="https://www.bing.com">
    <link rel="preconnect" href="https://www.google.com">
    <link rel="preconnect" href="https://cn.bing.com">


    <!-- å®‰å…¨ç­–ç•¥ -->
    <meta http-equiv="Content-Security-Policy"
          content="default-src 'self';
                   style-src 'self' 'unsafe-inline';
                   script-src 'self' 'unsafe-inline';
                   img-src 'self' data: https: blob:;
                   font-src 'self' data:;
                   connect-src 'self' https://www.bing.com data:;
                   base-uri 'self';
                   form-action 'self';">

    <!-- æ€§èƒ½ä¼˜åŒ– -->
    <meta name="theme-color" content="#1c1c1c">
    <meta name="color-scheme" content="dark light">

    <title>HomeDock</title>
  </head>
  
  <body>
    <div id="wrap">
      <div id="control-panel" class="control-panel" role="toolbar" aria-label="æ§åˆ¶é¢æ¿">
        <div class="mode-switcher" role="group" aria-label="æ¨¡å¼åˆ‡æ¢">
            <button class="switch-btn switch-btn-left active"
                    data-mode="external"
                    aria-pressed="true"
                    aria-label="å¤–éƒ¨åº”ç”¨æ¨¡å¼">
              OFFICE
            </button>
            <button class="switch-btn switch-btn-right"
                    data-mode="internal"
                    aria-pressed="false"
                    aria-label="å†…éƒ¨åº”ç”¨æ¨¡å¼">
              HOME
            </button>
        </div>
        <button id="edit-toggle-btn" class="edit-btn-new" aria-label="åˆ‡æ¢ç¼–è¾‘æ¨¡å¼" aria-pressed="false">
            <svg class="edit-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
            <span class="edit-text">ç¼–è¾‘</span>
        </button>
      </div>
      <div id="top">
        <div id="logo">
          <div class="type-js headline">
          	<h1 class="text-js">Welcome</h1>
          </div>
				</div>
			</div>
			<div id="logo-display">
				<img id="search-engine-logo" src="img/baidu.svg" alt="Search Engine" />
			</div>
			<div id="search-container" style="margin-top: 0;" role="search">
				<div id="search-box" role="group" aria-label="æœç´¢æ¡†">
          <div id="search-engine-selector"
               class="search-engine-selector"
               tabindex="0"
               role="combobox"
               aria-expanded="false"
               aria-haspopup="listbox"
               aria-label="é€‰æ‹©æœç´¢å¼•æ“">
            <span id="current-engine-label">ç™¾åº¦</span>
            <svg id="dropdown-arrow" class="dropdown-arrow" width="12" height="12" viewBox="0 0 12 12" fill="none" aria-hidden="true">
              <path d="M2 4L6 8L10 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div id="search-input-wrapper">
				<input type="text"
                       id="search-input"
                       placeholder="è¾“å…¥æœç´¢å†…å®¹ï¼ŒæŒ‰å›è½¦é”®æœç´¢..."
                       aria-label="æœç´¢å†…å®¹"
                       autocomplete="off" />
          </div>
          <button id="change-wallpaper-btn"
                  type="button"
                  aria-label="æ›´æ¢å£çº¸">
            æ¢ä¸€å¼ 
          </button>
          <select id="search-engine"
                  style="display: none;"
                  aria-label="æœç´¢å¼•æ“é€‰æ‹©">
						<option value="google">Google</option>
						<option value="bing">Bing</option>
						<option value="baidu" selected>ç™¾åº¦</option>
					</select>
          <div id="search-engine-dropdown"
               class="search-engine-dropdown"
               role="listbox"
               aria-label="æœç´¢å¼•æ“åˆ—è¡¨">
            <div class="dropdown-item"
                 data-engine="google"
                 role="option"
                 tabindex="0">
              <span>Google</span>
            </div>
            <div class="dropdown-item"
                 data-engine="bing"
                 role="option"
                 tabindex="0">
              <span>Bing</span>
            </div>
            <div class="dropdown-item"
                 data-engine="baidu"
                 role="option"
                 tabindex="0">
              <span>ç™¾åº¦</span>
            </div>
          </div>
				</div>
			</div>
			<div id="main">
			<!-- å¤–ç½‘è®¿é—®åœ°å€ -->
				<div id="app" class="app animated fadeInLeft">
					<ul id="external-apps" role="list" aria-label="å¤–éƒ¨åº”ç”¨åˆ—è¡¨">
						<!-- åº”ç”¨åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
					</ul>
					<button id="external-next-btn"
					        class="page-arrow page-arrow-right"
					        aria-label="ä¸‹ä¸€é¡µå¤–éƒ¨åº”ç”¨"
					        tabindex="0">
            â€º
          </button>
				</div>
				<!-- å†…ç½‘ç½‘è®¿é—®åœ°å€ -->
				<div id="app1" class="app animated fadeInRight">
					<ul id="internal-apps" role="list" aria-label="å†…éƒ¨åº”ç”¨åˆ—è¡¨">
						<!-- åº”ç”¨åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
					</ul>
					<button id="internal-next-btn"
					        class="page-arrow page-arrow-right"
					        aria-label="ä¸‹ä¸€é¡µå†…éƒ¨åº”ç”¨"
					        tabindex="0">
            â€º
          </button>
				</div>
				<div style="clear: both;"></div>
			</div>
		</div>
    <div id="footer">
      <div class="footer-contents">
        <div class="links">
          <a href="admin.html" id="admin-link">åå°ç®¡ç†</a>
        </div>
      </div>
    </div>
  </body>
  
  <!-- æ¨¡å—åŒ–è„šæœ¬åŠ è½½ -->
  <script>
    if (typeof window.NotificationUtils === 'undefined') {
      window.NotificationUtils = {
        showSuccess: function() { return null; },
        showError: function() { return null; },
        showWarning: function() { return null; },
        showInfo: function() { return null; },
        hideStatic: function() { return null; },
        clearStatic: function() { return null; },
        setSilentMode: function() {},
        isSilentMode: function() { return true; }
      };
    }
  </script>

  <!-- ========================================
     âœ… å…³é”® JavaScriptï¼ˆå»¶è¿ŸåŠ è½½ï¼Œä¸é˜»å¡æ¸²æŸ“ï¼‰
     ======================================== -->
  <script src="app.js" defer></script>

  <!-- ä¸»åº”ç”¨åˆå§‹åŒ–è„šæœ¬ -->
  <script>
    /**
     * åº”ç”¨åˆå§‹åŒ–
     */
    document.addEventListener('DOMContentLoaded', async function() {
      try {
        console.log('ğŸš€ HomeDock åˆå§‹åŒ–å¼€å§‹...');

        // ç­‰å¾…æ¨¡å—åŠ è½½
        const requiredModules = [
          'Helpers',
          'NotificationUtils',
          'ConfigManager',
          'AppRenderer',
          'UIManager',
          'SearchEngine'
        ];

        console.log('â³ ç­‰å¾…æ¨¡å—åŠ è½½...');
        await waitForModules(requiredModules, 5000);
        console.log('âœ… æ‰€æœ‰æ¨¡å—åŠ è½½å®Œæˆ');

        // åŠ è½½é…ç½®
        console.log('âš™ï¸ æ­£åœ¨åŠ è½½é…ç½®...');
        if (typeof window.ConfigManager !== 'undefined') {
          await window.ConfigManager.loadConfigWithRetry();
          console.log('âœ… é…ç½®åŠ è½½å®Œæˆ');
        }

        // åˆå§‹åŒ–UIç»„ä»¶
        console.log('ğŸ¨ æ­£åœ¨åˆå§‹åŒ–UIç»„ä»¶...');
        if (typeof window.AppRenderer !== 'undefined') {
          window.AppRenderer.refresh();
        }

        if (typeof window.UIManager !== 'undefined') {
          window.UIManager.setupSearchFunction();
        }

        // è®¾ç½®å£çº¸æ›´æ¢æŒ‰é’®
        if (typeof window.Helpers !== 'undefined') {
          const changeWallpaperBtn = window.Helpers.DOM.find('#change-wallpaper-btn');
          if (changeWallpaperBtn && typeof window.SearchEngine !== 'undefined') {
            window.Helpers.DOM.on(changeWallpaperBtn, 'click', () => {
              window.SearchEngine.changeWallpaper();
            });
          }
        }

        // åº”ç”¨èƒŒæ™¯é…ç½®
        console.log('ğŸ–¼ï¸ æ­£åœ¨åº”ç”¨èƒŒæ™¯é…ç½®...');
        if (typeof window.SearchEngine !== 'undefined') {
          window.SearchEngine.applyBackgroundFromConfig();
        }

        // æ€§èƒ½ä¼˜åŒ–
        if (typeof window.SearchEngine !== 'undefined') {
          window.SearchEngine.optimizeBackgroundPerformance();
        }

        // é¢„åŠ è½½ä¸‹ä¸€å¼ å£çº¸
        setTimeout(() => {
          if (typeof window.SearchEngine !== 'undefined') {
            window.SearchEngine.preloadNextWallpaper();
          }
        }, 3000);

        console.log('ğŸ‰ HomeDock åˆå§‹åŒ–å®Œæˆ');

      } catch (error) {
        console.error('âŒ åº”ç”¨åˆå§‹åŒ–å¤±è´¥:', error);

        console.error('åº”ç”¨åˆå§‹åŒ–å¤±è´¥:', error.message);

        // æ˜¾ç¤ºç¼ºå¤±çš„æ¨¡å—
        const requiredModules = [
          'Helpers',
          'NotificationUtils',
          'ConfigManager',
          'AppRenderer',
          'UIManager',
          'SearchEngine'
        ];

        const missing = requiredModules.filter(name => typeof window[name] === 'undefined');
        if (missing.length > 0) {
          console.error('ç¼ºå¤±çš„æ¨¡å—:', missing);
        }
      }
    });

    /**
     * ç­‰å¾…æ¨¡å—åŠ è½½
     */
    function waitForModules(moduleNames, timeout = 10000) {
      return new Promise((resolve, reject) => {
        const startTime = Date.now();

        function checkModules() {
          const loaded = moduleNames.every(name => typeof window[name] !== 'undefined');

          if (loaded) {
            resolve();
            return;
          }

          if (Date.now() - startTime > timeout) {
            const missing = moduleNames.filter(name => typeof window[name] === 'undefined');
            reject(new Error(`ç­‰å¾…æ¨¡å—è¶…æ—¶: ${missing.join(', ')}`));
            return;
          }

          setTimeout(checkModules, 100);
        }

        checkModules();
      });
    }

    // å…¨å±€é”™è¯¯å¤„ç†
    window.addEventListener('error', function(e) {
      console.error('å…¨å±€é”™è¯¯:', e.error);
    });

    // æœªå¤„ç†çš„Promiseæ‹’ç»
    window.addEventListener('unhandledrejection', function(e) {
      console.error('æœªå¤„ç†çš„Promiseæ‹’ç»:', e.reason);
      e.preventDefault();
    });
  </script>

  <!-- ç¼–è¾‘åº”ç”¨æ¨¡æ€æ¡† -->
  <div id="editModal"
       class="edit-modal"
       style="display: none;"
       role="dialog"
       aria-modal="true"
       aria-labelledby="modal-title"
       aria-describedby="modal-description">
    <div class="edit-modal-content">
      <button class="edit-modal-close"
              aria-label="å…³é—­å¯¹è¯æ¡†"
              tabindex="0">
        &times;
      </button>
      <h2 id="modal-title">ç¼–è¾‘åº”ç”¨</h2>
      <p id="modal-description" style="display:none;">ç¼–è¾‘åº”ç”¨çš„åç§°ã€URL å’Œå›¾æ ‡</p>
      <form id="editForm"
            aria-label="ç¼–è¾‘åº”ç”¨è¡¨å•"
            novalidate>
        <div class="form-group">
          <label for="appName">åº”ç”¨åç§°ï¼š</label>
          <input type="text"
                 id="appName"
                 name="appName"
                 required
                 aria-required="true"
                 autocomplete="off">
        </div>
        <div class="form-group">
          <label for="externalUrl">å¤–éƒ¨URLï¼š</label>
          <input type="url"
                 id="externalUrl"
                 name="externalUrl"
                 placeholder="https://"
                 autocomplete="url">
        </div>
        <div class="form-group">
          <label for="internalUrl">å†…éƒ¨URLï¼š</label>
          <input type="url"
                 id="internalUrl"
                 name="internalUrl"
                 placeholder="http://"
                 autocomplete="url">
        </div>
        <div class="form-group">
          <label for="iconPath">å›¾æ ‡è·¯å¾„ï¼š</label>
          <input type="text"
                 id="iconPath"
                 name="iconPath"
                 autocomplete="off">
          <button type="button"
                  id="iconPickerToggle"
                  class="icon-picker-toggle"
                  aria-expanded="false"
                  aria-controls="iconPicker">
            æµè§ˆé¢„è®¾å›¾æ ‡
          </button>
          <div id="iconPicker"
               class="icon-picker"
               role="listbox"
               aria-label="é€‰æ‹©å›¾æ ‡">
            <div class="icon-picker-grid" id="iconPickerGrid"></div>
          </div>
        </div>
        <div class="form-actions">
          <button type="submit"
                  class="btn-save"
                  aria-label="ä¿å­˜åº”ç”¨æ›´æ”¹">
            ä¿å­˜
          </button>
          <button type="button"
                  class="btn-cancel"
                  aria-label="å–æ¶ˆç¼–è¾‘">
            å–æ¶ˆ
          </button>
        </div>
      </form>
    </div>
  </div>

</html>
